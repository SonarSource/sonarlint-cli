#!/bin/sh
#
# SonarLint Startup Script for Unix
#
# Optional ENV vars:
#   SONARLINT_HOME - location of SonarLint's installed home dir
#   SONARLINT_OPTS - parameters passed to the Java VM when running SonarLint

real_path() {
  target=$1

  (
  while true; do
    cd "$(dirname "$target")"
    target=$(basename "$target")
    link=$(readlink "$target")
    test "$link" || break
    target=$link
  done

  echo "$(pwd -P)/$target"
  )
}

if [ -z "$SONARLINT_HOME" ] ; then
  PRG="$0"

  if [ -h "$PRG" ] ; then
    # resolve symlinks
    PRG=$(real_path "$PRG")
  fi

  SONARLINT_HOME=$(dirname "$PRG")/..

  # make it fully qualified
  SONARLINT_HOME=$(cd "$SONARLINT_HOME" && pwd)
fi

# check that the SONARLINT_HOME has been correctly set
if [ ! -f "$SONARLINT_HOME/lib/sonarlint-cli-${project.version}.jar" ] ; then
  echo '$SONARLINT_HOME' does not point to a valid installation directory: $SONARLINT_HOME
  exit 1
fi

if [ -n "$JAVA_HOME" ]
then
  JAVA_CMD="$JAVA_HOME/bin/java"
else
  JAVA_CMD="$(which java)"
fi

JAR_FILE="${SONARLINT_HOME}"/lib/sonarlint-cli-${project.version}.jar
PROJECT_HOME=$PWD

#echo "Info: Using sonarlint-cli in $SONARLINT_HOME"
#echo "Info: Using java at $JAVA_CMD"
#echo "Info: Using classpath $JAR_FILE"
#echo "Info: Using project $PROJECT_HOME"

exec "$JAVA_CMD" \
  -Djava.awt.headless=true \
  $SONARLINT_OPTS \
  -classpath  $JAR_FILE \
  "-Dsonarlint.home=\${SONARLINT_HOME}" \
  "-Dproject.home=\${PROJECT_HOME}" \
  -Dorg.freemarker.loggerLibrary=none \
  org.sonarlint.cli.Main "$@"

